name: Deploy to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Build application
      run: npm run build

    - name: Generate deployment summary
      run: |
        echo "## ðŸŽ‰ Production Deployment" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Todo Manager v1.0" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Build completed successfully!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Deployment Options" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Vercel (Recommended):**" >> $GITHUB_STEP_SUMMARY
        echo "1. Connect your GitHub repository to Vercel" >> $GITHUB_STEP_SUMMARY
        echo "2. Deploy automatically on every push" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Netlify:**" >> $GITHUB_STEP_SUMMARY
        echo "- Build command: \`npm run build\`" >> $GITHUB_STEP_SUMMARY
        echo "- Publish directory: \`.next\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Docker:**" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
        echo "docker build -t todo-manager ." >> $GITHUB_STEP_SUMMARY
        echo "docker run -p 3000:3000 todo-manager" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

    - name: Archive production artifacts
      uses: actions/upload-artifact@v4
      with:
        name: production-build
        path: |
          .next
          public
          package.json
          package-lock.json
        retention-days: 30
